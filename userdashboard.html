<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>User Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --text: #111111;
  --blue: #0a53c1;
  --ink-20: #f4f6f8;
  --white: #ffffff;
  --border: #e6e8eb;
  --shadow: 0 6px 24px rgba(0, 0, 0, .06);
}
.status-approved { color: green; font-weight: 600; }
.status-declined { color: red; font-weight: 600; }

* { box-sizing: border-box; }
body { margin: 0; font-family: Inter, system-ui, sans-serif; background: var(--white); color: var(--text); }
.app { display: grid; grid-template-columns: 240px 1fr; min-height: 100vh; }
.sidebar { border-right: 1px solid var(--border); background: #4e73df; }
.brand { font-weight: 800; text-transform: uppercase; padding: 1rem; border-bottom: 1px solid var(--border); }
nav { padding: 1rem; }
.nav-item { display: block; padding: .6rem; border-radius: 8px; text-decoration: none; color: var(--text); }
.nav-item:hover, .nav-item.active { background: var(--ink-20); }
.main { display: grid; grid-template-rows: 64px 1fr; min-width: 0; }
.topbar { display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; border-bottom: 1px solid var(--border); }
.btn { border: 1px solid var(--text); background: transparent; padding: .4rem .8rem; border-radius: 8px; cursor: pointer; }
.content { padding: 1rem; overflow: auto; }
.grid { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.card { border: 1px solid var(--border); border-radius: 12px; padding: 1rem; box-shadow: var(--shadow); }
.card.blue1 { background: #e3f2fd; color: #0a53c1; }
.card.blue2 { background: #90caf9; color: #0a53c1; }
.card.blue3 { background: #42a5f5; color: #fff; }
.card.chart-container { height: 300px; }
table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
th, td { border-bottom: 1px solid var(--border); padding: .6rem; text-align: left; }
th { font-size: .85rem; opacity: .7; }
.chat-message { max-width: 70%; padding: .5rem .8rem; border-radius: 12px; font-size: 0.9rem; }
.chat-user { background: #0a53c1; color: white; align-self: flex-end; }
.chat-bot { background: #e6e6e6; color: #111; align-self: flex-start; }
table td:nth-child(7) { font-weight: 600; }
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar open" id="sidebar">
    <div class="brand">LGU 3 USER SYSTEM</div>
    <nav>
      <a href="Marketmap.html" class="nav-item">Market Map</a>
      <a href="userdashboard.html" class="nav-item active">Dashboard</a>
      <a href="uservendor.html" class="nav-item">Vendor Management</a>
      <a href="usercommodity.html" class="nav-item">Commodity and Price Monitoring</a>
      <a href="userinspection.html" class="nav-item">Inspection and Compliance</a>
      <a href="userreports.html" class="nav-item">Reports and Dashboard with AI Analytic</a>
      <a href="usersettings.html" class="nav-item">Settings</a>
      <a href="main.html" class="nav-item logout-btn" style="margin-top: 2rem; font-weight: bold;">Logout</a>
    </nav>
  </aside>

  <section class="main">
    <header class="topbar">
      <div><button class="btn" id="backBtn">‚Üê Back</button></div>
      <div><button class="btn" id="exportBtn">Export</button></div>
    </header>

    <div class="content" id="contentArea">
      <h1>Dashboard</h1>

      <div class="grid">
        <div class="card blue1"><h3>Price Variance / Cost Savings</h3><p>‚Ç±12,500</p><small>+8% vs last month</small></div>
        <div class="card blue2"><h3>Defect Rate / Compliance Score</h3><p>2%</p><small>-1 pt</small></div>
        <div class="card blue3"><h3>Vendor Performance Score</h3><p>87/100</p><small>Stable</small></div>
      </div>

      <div class="card chart-container">
        <h3>Price Chain Flow (Last 6 Weeks)</h3>
        <canvas id="pipelineChart"></canvas>
      </div>

      <div class="card" style="margin-top:1.5rem;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h3>Registered Vendors</h3>
          üîé <input id="searchInput" type="search" placeholder="Search vendors‚Ä¶">
        </div>
        <table id="vendorEngagementsTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Contact No.</th>
              <th>Nature of Business</th>
              <th>Business Permit</th>
              <th>Monthly Payment</th>
              <th>Email</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="grid" style="margin-top:2rem;">
        <div class="card">
          <h3>Vendor Performance Dashboard</h3>
          <canvas id="vendorChart"></canvas>
        </div>

        <div class="card">
          <h3>Recent Complaints</h3>
          <select id="complaintSelect" style="width:100%;padding:.4rem;">
            <option value="">-- Select Complaint Ref No. --</option>
          </select>
          <button id="viewComplaintBtn" class="btn" style="margin-top:.5rem;">View Complaint</button>
          <p id="complaintMessage" style="margin-top:.5rem;"></p>
        </div>

        <div class="card">
          <h3>AI Chat Support</h3>
          <div id="chatboxContainer" style="height:250px;overflow-y:auto;border:1px solid #ccc;padding:.5rem;border-radius:8px;"></div>
          <div style="display:flex;gap:.5rem;margin-top:.5rem;">
            <input id="chatInput" type="text" placeholder="Type your question..." style="flex:1;padding:.4rem;">
            <button id="chatSendBtn" class="btn">Send</button>
          </div>
        </div>
      </div>

    </div>
  </section>
</div>

<script>
const STORAGE_KEYS = { vendors:"vendor_engagements" };

if(!localStorage.getItem(STORAGE_KEYS.vendors)){
  localStorage.setItem(STORAGE_KEYS.vendors, JSON.stringify([
    {name:"Gacusan, Aira Jane",contact:"0912-345-6789",nature:"Fish Store",permit:"BP-00123",payment:"3000",email:"aira.gacusan@example.com",status:"Accepted"},
    {name:"Pena, Rona Mae",contact:"0934-567-8901",nature:"Meat Shop",permit:"BP-00789",payment:"3000",email:"rona.pena@example.com",status:"Accepted"}
  ]));
}

function loadVendors(){
  const vendors = JSON.parse(localStorage.getItem(STORAGE_KEYS.vendors)) || [];

 
  const approved = vendors.filter(v => v.status === "Accepted");

  const tbody = document.querySelector("#vendorEngagementsTable tbody");
  tbody.innerHTML = "";

  if(!approved.length){
    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center">No approved vendors</td></tr>`;
    return;
  }

  approved.forEach(v=>{
    tbody.innerHTML += `
    <tr>
      <td>${v.name}</td>
      <td>${v.contact}</td>
      <td>${v.nature || "‚Äî"}</td>
      <td>${v.permit}</td>
      <td>${v.payment || "‚Äî"}</td>
      <td>${v.email}</td>
      <td class="status-accepted">‚úî Accepted</td>
    </tr>`;
  });
}

// Search vendors
document.getElementById("searchInput").addEventListener("keyup", function() {
  const filter = this.value.toLowerCase();
  document.querySelectorAll("#vendorEngagementsTable tbody tr").forEach(r=>{
    r.style.display = r.innerText.toLowerCase().includes(filter) ? "" : "none";
  });
});

// Charts
new Chart(document.getElementById("pipelineChart"), {
  type:"line",
  data:{ labels:["Week 1","Week 2","Week 3","Week 4","Week 5","Week 6"], datasets:[{data:[5,8,6,10,7,9],borderColor:"#0a53c1",fill:true}] }
});
new Chart(document.getElementById("vendorChart"), {
  type:"bar",
  data:{ labels:["Fish","Meat Shop","Grocery","Textile"], datasets:[{data:[87,65,72,90],backgroundColor:"#0a53c1"}] },
  options:{ scales:{ y:{ beginAtZero:true,max:100 } } }
});

// Complaints
const complaints = { "RPT-001":"Vendor delayed chicken delivery", "RPT-002":"Incomplete Fish supplies", "RPT-003":"Meat delivery arrived late", "RPT-004":"Grocery items missing on arrival" };
const select = document.getElementById("complaintSelect");
Object.keys(complaints).forEach(ref=>{
  const opt=document.createElement("option"); opt.value=ref; opt.textContent=ref; select.appendChild(opt);
});
document.getElementById("viewComplaintBtn").onclick=()=>{
  const ref=select.value;
  document.getElementById("complaintMessage").textContent = complaints[ref] || "";
};

// Chat support
function addMessage(sender,text){
  const div=document.createElement("div");
  div.className="chat-message "+(sender==="user"?"chat-user":"chat-bot");
  div.innerHTML=text;
  document.getElementById("chatboxContainer").appendChild(div);
}
document.getElementById("chatSendBtn").onclick=()=>{
  const input=document.getElementById("chatInput"); 
  const msg=input.value.trim();
  if(!msg) return;
  addMessage("user",msg);
  let reply="ü§ñ Ask about status, performance, or complaints.";
  if(msg.toLowerCase().includes("status")) reply="Most vendors are performing well.";
  if(msg.toLowerCase().includes("performance")) reply="Average vendor performance is 85%.";
  if(msg.toLowerCase().includes("complaint")) reply="There are 4 active complaints.";
  setTimeout(()=>addMessage("bot",reply),400);
  input.value="";
};

// Load vendors on page load
loadVendors();
</script>
</body>
</html>

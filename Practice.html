<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barangay Market Map</title>

<style>
body{margin:0;font-family:Arial;background:#f4f6f9;}
.app{display:grid;grid-template-columns:220px 1fr;height:100vh;}
.sidebar{background:#4e73df;color:#fff;padding:15px;}
.sidebar a{display:block;padding:8px;color:#fff;text-decoration:none;border-radius:6px;margin-bottom:5px;}
.sidebar a:hover{background:#fff;color:#4e73df;}
.main{display:flex;flex-direction:column;}
.topbar{background:#fff;padding:10px 15px;border-bottom:1px solid #ddd;display:flex;justify-content:space-between;}
.content{padding:15px;}

.map-wrapper{border:2px solid #333;background:#ddd;width:100%;height:620px;position:relative;overflow:hidden;border-radius:10px;}
#map{transform-origin:0 0;cursor:grab;}

.stall{stroke:#444;stroke-width:1;cursor:pointer;}
.occupied{fill:#9ec5ff;}
.vacant{fill:#f2f2f2;}
.violation{fill:#ff4d4d;}
.reserved{fill:#ffd700;}

.wet{fill:#cfe8ff;}
.dry{fill:#fff2cc;}

.walkway{fill:#888;opacity:.6;}

.label{font-size:14px;font-weight:bold;fill:#000;}

.info-panel{margin-top:10px;background:#fff;padding:10px;border-radius:6px;border:1px solid #ddd;font-size:14px;}
</style>
</head>
<body>

<div class="app">
<div class="sidebar">
<h2>LGU ADMIN</h2>
<a href="#">Dashboard</a>
<a href="#">Vendor Management</a>
<a href="#">Compliance</a>
<a href="#">Logout</a>
</div>

<div class="main">
<div class="topbar">
<h3>Barangay Market Map</h3>
<input id="search" placeholder="Search stall no..." style="padding:5px;">
</div>

<div class="content">
<div class="map-wrapper">
<svg id="map" width="1400" height="800">

<!-- MARKET BORDER -->
<polygon points="50,50 1200,50 1350,250 1250,720 100,720 50,450"
fill="#f7f0c8" stroke="#333" stroke-width="4"/>

<!-- LABELS -->
<text x="120" y="110" class="label">WET SECTION</text>
<text x="820" y="110" class="label">DRY SECTION</text>

<!-- WALKWAYS (AUTO ALIGNED) -->
<g id="walkways"></g>

<!-- STALL GROUPS -->
<g id="wetStalls"></g>
<g id="dryStalls"></g>

</svg>
</div>

<div class="info-panel" id="info">Click a stall to view details.</div>
</div>
</div>
</div>

<script>
const vendors={
2:{name:"Pedro Fish Vendor",status:"occupied"},
10:{name:"Maria Meat Shop",status:"occupied"},
20:{name:"Violation Stall",status:"violation"},
80:{name:"Reserved Stall",status:"reserved"},
};

// CONFIG
const STALL_SIZE=40;
const GAP=8;       // spacing between stalls
const AISLE=30;    // walkway width

function drawBlock(start,x,y,rows,cols,section){
  const g=document.getElementById(section==="wet"?"wetStalls":"dryStalls");
  const walk=document.getElementById("walkways");
  let num=start;

  // vertical walkways between columns
  for(let c=1;c<cols;c++){
    let wx=x+(STALL_SIZE+GAP)*c - GAP/2 - AISLE/2;
    let wy=y-10;
    let wh=(STALL_SIZE+GAP)*rows+20;
    const r=document.createElementNS("http://www.w3.org/2000/svg","rect");
    r.setAttribute("x",wx);
    r.setAttribute("y",wy);
    r.setAttribute("width",AISLE);
    r.setAttribute("height",wh);
    r.setAttribute("class","walkway");
    walk.appendChild(r);
  }

  // horizontal walkways between rows
  for(let r=1;r<rows;r++){
    let wx=x-10;
    let wy=y+(STALL_SIZE+GAP)*r - GAP/2 - AISLE/2;
    let ww=(STALL_SIZE+GAP)*cols+20;
    const rr=document.createElementNS("http://www.w3.org/2000/svg","rect");
    rr.setAttribute("x",wx);
    rr.setAttribute("y",wy);
    rr.setAttribute("width",ww);
    rr.setAttribute("height",AISLE);
    rr.setAttribute("class","walkway");
    walk.appendChild(rr);
  }

  // stalls
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      let sx=x+c*(STALL_SIZE+GAP);
      let sy=y+r*(STALL_SIZE+GAP);

      const rect=document.createElementNS("http://www.w3.org/2000/svg","rect");
      rect.setAttribute("x",sx);
      rect.setAttribute("y",sy);
      rect.setAttribute("width",STALL_SIZE);
      rect.setAttribute("height",STALL_SIZE);
      rect.classList.add("stall",section);

      let status="vacant";
      if(vendors[num]) status=vendors[num].status;
      rect.classList.add(status);
      rect.dataset.no=num;

      rect.onclick=()=>{
        const v=vendors[num];
        document.getElementById("info").innerHTML=v?
        `<b>Stall ${num}</b><br>${v.name}<br>Status: ${v.status}`:
        `<b>Stall ${num}</b><br>Status: Vacant`;
      };

      g.appendChild(rect);

      const text=document.createElementNS("http://www.w3.org/2000/svg","text");
      text.setAttribute("x",sx+10);
      text.setAttribute("y",sy+24);
      text.setAttribute("font-size","9");
      text.textContent=num;
      g.appendChild(text);

      num++;
    }
  }
}

// WET SECTION (LEFT)
drawBlock(1,120,160,4,5,"wet");
drawBlock(21,120,360,4,5,"wet");
drawBlock(41,120,560,4,5,"wet");

// DRY SECTION (RIGHT)
drawBlock(100,760,160,4,5,"dry");
drawBlock(120,760,360,4,5,"dry");
drawBlock(140,760,560,4,5,"dry");

// SEARCH
document.getElementById("search").oninput=function(){
  const val=this.value;
  document.querySelectorAll(".stall").forEach(s=>{
    s.style.stroke="#444";
    if(s.dataset.no===val){
      s.style.stroke="black";
      s.style.strokeWidth=3;
    }
  });
};

// ZOOM + DRAG
let scale=1,drag=false,startX,startY,offsetX=0,offsetY=0;
const map=document.getElementById("map");

map.addEventListener("wheel",e=>{
  e.preventDefault();
  scale+=e.deltaY*-0.001;
  scale=Math.min(Math.max(0.5,scale),2.5);
  map.style.transform=`translate(${offsetX}px,${offsetY}px) scale(${scale})`;
});

map.addEventListener("mousedown",e=>{
  drag=true;
  startX=e.clientX-offsetX;
  startY=e.clientY-offsetY;
  map.style.cursor="grabbing";
});
window.addEventListener("mouseup",()=>{drag=false;map.style.cursor="grab";});
window.addEventListener("mousemove",e=>{
  if(!drag)return;
  offsetX=e.clientX-startX;
  offsetY=e.clientY-startY;
  map.style.transform=`translate(${offsetX}px,${offsetY}px) scale(${scale})`;
});
</script>
</body>
</html>

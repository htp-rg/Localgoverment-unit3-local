<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barangay Market Map - LGU Admin</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --text: #111111;
  --blue: #4e73df;
  --ink-20: #f4f6f8;
  --white: #ffffff;
  --border: #e6e8eb;
  --shadow: 0 6px 24px rgba(0, 0, 0, .06);
}

/* GLOBAL */
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: #f4f6f9;
  color: var(--text);
  overflow: hidden;
}

.app {
  display: grid;
  grid-template-columns: 240px 1fr;
  height: 100vh;
}

/* SIDEBAR */
.sidebar {
  background: var(--blue);
  color: #fff;
  border-right: 1px solid var(--border);
}
.brand {
  font-weight: 800;
  text-transform: uppercase;
  padding: 1rem;
  border-bottom: 1px solid rgba(255,255,255,.2);
}
nav { padding: 1rem; }
.nav-item {
  display: block;
  padding: .6rem;
  border-radius: 8px;
  text-decoration: none;
  color: #fff;
  margin-bottom: 6px;
  transition: .2s;
}
.nav-item:hover,
.nav-item.active {
  background: rgba(255,255,255,.15);
}

/* MAIN */
.main {
  display: grid;
  grid-template-rows: 64px 1fr;
  min-width: 0;
  background: #eaecf4;
}

/* TOPBAR */
.topbar {
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 1rem;
  border-bottom: 1px solid var(--border);
}
.btn {
  border: 1px solid var(--blue);
  background: transparent;
  padding: .4rem .8rem;
  border-radius: 8px;
  cursor: pointer;
  color: var(--blue);
}
.btn:hover { background: var(--blue); color: #fff; }

.content {
  padding: 1rem;
  overflow: auto;
  display: flex;
  flex-direction: column;
}

/* MAP */
.map-wrapper {
  border: 1px solid #ccc;
  background: #f8f9fc;
  width: 100%;
  height: 70vh;
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
}
#map {
  transform-origin: 0 0;
  cursor: grab;
}

/* STALL STYLES */
.stall {
  stroke: #444;
  stroke-width: 0.5;
  cursor: pointer;
  transition: fill 0.2s;
}
.stall:hover {
  stroke-width: 2;
  stroke: #000;
}

.occupied { fill: #9ec5ff; }
.vacant { fill: #ffffff; }
.violation { fill: #ff4d4d; }
.reserved { fill: #ffd700; }

.walkway { fill: #d1d3e2; opacity: .8; }
.label {
  font-size: 16px;
  font-weight: bold;
  fill: var(--blue);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* INFO PANEL */
.info-panel {
  margin-top: 12px;
  background: #fff;
  padding: 12px;
  border-radius: 8px;
  border-left: 5px solid var(--blue);
  font-size: 14px;
  box-shadow: var(--shadow);
}

/* LEGEND */
.legend {
  display: flex;
  gap: 15px;
  margin-top: 10px;
  font-size: 12px;
}
.legend-item {
  display: flex;
  align-items: center;
  gap: 5px;
}
.box {
  width: 12px;
  height: 12px;
  border: 1px solid #333;
}
</style>
</head>
<body>

<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">LGU 3 ADMIN SYSTEM</div>
    <nav>
      <a href="admindashboard.html" class="nav-item">Dashboard</a>
      <a href="adminvendor.html" class="nav-item">Vendor Management</a>
      <a href="admincommodity.html" class="nav-item">Commodity and Price Monitoring</a>
      <a href="admininspection.html" class="nav-item">Inspection and Compliance</a>
      <a href="reports.html" class="nav-item">Reports and AI Analytics</a>
      <a href="adminsettings.html" class="nav-item">Settings</a>
      <a href="main.html" class="nav-item" style="margin-top:1.5rem;font-weight:bold;">Logout</a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <section class="main">
    <header class="topbar">
      <h3>Market Layout Manager</h3>
      <input id="search" placeholder="Search stall no..."
        style="padding:8px;border:1px solid #ddd;border-radius:6px;width:200px;">
    </header>

    <div class="content">

      <div class="map-wrapper">
        <svg id="map" width="1400" height="900">
          <polygon points="50,50 1200,50 1350,250 1250,850 100,850 50,450"
            fill="#fff" stroke="#b7b9cc" stroke-width="2"/>

          <text x="150" y="110" class="label">Wet Section</text>
          <text x="650" y="110" class="label">Dry Section</text>

          <g id="walkways"></g>
          <g id="wetStalls"></g>
          <g id="dryStalls"></g>
        </svg>
      </div>

      <div class="info-panel" id="info">
        <strong>Unit Details:</strong> Click a stall on the map to view data.
      </div>

      <div class="legend">
        <div class="legend-item"><div class="box vacant"></div> Vacant</div>
        <div class="legend-item"><div class="box occupied"></div> Occupied</div>
        <div class="legend-item"><div class="box reserved"></div> Reserved</div>
        <div class="legend-item"><div class="box violation"></div> Violation</div>
      </div>

    </div>
  </section>
</div>

<script>
const vendors = {
  2: {name: "Pedro Fish Vendor", status: "occupied"},
  10: {name: "Maria Meat Shop", status: "occupied"},
  20: {name: "Juan Cold Storage", status: "violation"},
  105: {name: "Elena Boutique", status: "reserved"},
};

const STALL_SIZE = 40;
const GAP = 4;

function drawWalkway(x, y, w, h) {
  const walk = document.getElementById("walkways");
  const r = document.createElementNS("http://www.w3.org/2000/svg", "rect");
  r.setAttribute("x", x);
  r.setAttribute("y", y);
  r.setAttribute("width", w);
  r.setAttribute("height", h);
  r.setAttribute("class", "walkway");
  walk.appendChild(r);
}

function drawBlock(start, x, y, rows, cols, section) {
  const g = document.getElementById(section === "wet" ? "wetStalls" : "dryStalls");
  let num = start;

  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      let sx = x + c * (STALL_SIZE + GAP);
      let sy = y + r * (STALL_SIZE + GAP);

      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", sx);
      rect.setAttribute("y", sy);
      rect.setAttribute("width", STALL_SIZE);
      rect.setAttribute("height", STALL_SIZE);
      rect.classList.add("stall");

      let status = vendors[num] ? vendors[num].status : "vacant";
      rect.classList.add(status);
      rect.dataset.no = num;

      rect.onclick = () => {
        const v = vendors[rect.dataset.no];
        document.getElementById("info").innerHTML = v ?
          `<b>Stall ${rect.dataset.no}</b> | Vendor: ${v.name} | Status: <b>${v.status.toUpperCase()}</b>` :
          `<b>Stall ${rect.dataset.no}</b> | Status: Vacant`;
      };

      g.appendChild(rect);

      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
      text.setAttribute("x", sx + 5);
      text.setAttribute("y", sy + 25);
      text.setAttribute("font-size", "10");
      text.setAttribute("fill", "#333");
      text.style.pointerEvents = "none";
      text.textContent = num;
      g.appendChild(text);

      num++;
    }
  }
}

// WALKWAYS
drawWalkway(480, 80, 60, 750);
drawWalkway(100, 320, 380, 40);
drawWalkway(100, 560, 380, 40);
drawWalkway(540, 320, 450, 40);
drawWalkway(540, 560, 450, 40);

// BLOCKS
drawBlock(1, 150, 140, 4, 5, "wet");
drawBlock(21, 150, 380, 4, 5, "wet");
drawBlock(41, 150, 620, 4, 5, "wet");

drawBlock(100, 650, 140, 4, 7, "dry");
drawBlock(130, 650, 380, 4, 7, "dry");
drawBlock(160, 650, 620, 4, 7, "dry");

// SEARCH
document.getElementById("search").oninput = function() {
  const val = this.value;
  document.querySelectorAll(".stall").forEach(s => {
    if (s.dataset.no === val && val !== "") {
      s.style.stroke = "#000";
      s.style.strokeWidth = "4";
    } else {
      s.style.stroke = "#444";
      s.style.strokeWidth = "0.5";
    }
  });
};

// PAN & ZOOM
let scale = 1, drag = false, startX, startY, offsetX = 0, offsetY = 0;
const map = document.getElementById("map");

map.addEventListener("wheel", e => {
  e.preventDefault();
  scale += e.deltaY * -0.001;
  scale = Math.min(Math.max(0.4, scale), 3);
  map.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
});

map.addEventListener("mousedown", e => {
  if (e.target.classList.contains('stall')) return;
  drag = true;
  startX = e.clientX - offsetX;
  startY = e.clientY - offsetY;
  map.style.cursor = "grabbing";
});

window.addEventListener("mouseup", () => {
  drag = false;
  map.style.cursor = "grab";
});

window.addEventListener("mousemove", e => {
  if (!drag) return;
  offsetX = e.clientX - startX;
  offsetY = e.clientY - startY;
  map.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barangay Market Map - LGU Admin</title>

<style>
:root {
  --text: #111111;
  --blue: #0a53c1;
  --ink-20: #f4f6f8;
  --white: #ffffff;
  --border: #e6e8eb;
  --shadow: 0 6px 24px rgba(0, 0, 0, .06);
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: var(--white);
  color: var(--text);
}
.app { display: grid; grid-template-columns: 240px 1fr; min-height: 100vh; }

.sidebar {
  border-right: 1px solid var(--border);
  background: #4e73df;
  color:#fff;
}
.brand {
  font-weight: 800;
  text-transform: uppercase;
  padding: 1rem;
  border-bottom: 1px solid rgba(255,255,255,.2);
}
nav { padding: 1rem; }
.nav-item {
  display: block; padding: .6rem;
  border-radius: 8px; text-decoration: none; color: #fff;
}
.nav-item:hover, .nav-item.active { background: rgba(255,255,255,.15); }

.main { display: grid; grid-template-rows: 64px 1fr; min-width: 0; }
.topbar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 1rem; border-bottom: 1px solid var(--border);
}
.btn {
  border: 1px solid var(--text);
  background: transparent; padding: .4rem .8rem;
  border-radius: 8px; cursor: pointer;
}
.content { padding: 1rem; overflow: auto; }

/* MAP */
.map-wrapper{
  border:1px solid #ccc;
  background:#f8f9fc;
  width:100%;
  height:70vh;
  border-radius:12px;
  overflow:hidden;
  position: relative;
}
svg { user-select:none; }
#map-group { cursor:grab; }

/* STALL */
.stall{stroke:#444;stroke-width:.5;cursor:pointer;}
.stall:hover{stroke-width:2;stroke:#000;}
.occupied{fill:#9ec5ff;}
.vacant{fill:#fff;}
.violation{fill:#ff4d4d;}
.reserved{fill:#ffd700;}
.walkway{fill:#d1d3e2; opacity:.6;}
.label{font-size:18px; font-weight:bold; fill:var(--blue);}
.facility-text{font-size:11px; font-weight:bold; fill:#333; pointer-events: none;}

/* INFO */
.info-panel{
  margin-top:10px;
  background:#fff;
  padding:15px;
  border-radius:8px;
  border-left:5px solid var(--blue);
  box-shadow:var(--shadow);
  font-size:14px;
}
/* Legend */
.legend{
  margin-top:12px;
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  font-size:12px;
}
.legend span{
  display:flex;
  align-items:center;
  gap:6px;
}
.legend-box{
  width:14px;
  height:14px;
  border-radius:3px;
  border:1px solid #999;
}

.box{width:12px;height:12px;border:1px solid #333;}
.legend-item{display:flex;align-items:center;gap:5px;}
  
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand">LGU 3 ADMIN SYSTEM</div>
    <nav>
      <a href="admindashboard.html" class="nav-item active">Dashboard</a>
      <a href="adminvendor.html" class="nav-item">Vendor Management</a>
      <a href="admincommodity.html" class="nav-item">Commodity and Price Monitoring</a>
      <a href="admininspection.html" class="nav-item">Inspection and Compliance</a>
      <a href="adminsettings.html" class="nav-item">Settings</a>
      <a href="main.html" class="nav-item" style="margin-top:2rem;font-weight:bold;">Logout</a>
    </nav>
  </aside>

  <section class="main">
    <header class="topbar">
      <button class="btn" id="backBtn">‚Üê Back</button>
      <button class="btn">Export</button>
    </header>

    <div class="content">
      <div class="map-wrapper" id="wrapper">
        <svg width="1300" height="900" viewBox="0 0 1300 900">
          <g id="map-group">
            <!-- MARKET BORDER -->
            <rect x="20" y="20" width="1260" height="860" fill="none" stroke="#b7b9cc" stroke-width="2" rx="10"/>

            <!-- MAIN WALKWAYS -->
            <rect x="600" y="20" width="80" height="860" class="walkway"/>
            <rect x="20" y="270" width="560" height="50" class="walkway"/>
            <rect x="700" y="270" width="580" height="50" class="walkway"/>
            <rect x="20" y="570" width="560" height="50" class="walkway"/>
            <rect x="700" y="570" width="580" height="50" class="walkway"/>

            <!-- SECTION LABELS -->
            <text x="200" y="60" class="label">WET SECTION</text>
            <text x="880" y="60" class="label">DRY SECTION</text>

            <!-- FACILITIES (NO OVERLAP) -->
            <rect x="40" y="80" width="130" height="60" fill="#e3f2fd" stroke="#4e73df" rx="6"/>
            <text x="55" y="115" class="facility-text">ADMIN OFFICE</text>

            <rect x="40" y="780" width="100" height="60" fill="#e8f5e9" stroke="#2e7d32" rx="6"/>
            <text x="55" y="815" class="facility-text">CR MALE</text>

            <rect x="160" y="780" width="100" height="60" fill="#fce4ec" stroke="#c2185b" rx="6"/>
            <text x="175" y="815" class="facility-text">CR FEMALE</text>

            <rect x="600" y="20" width="80" height="40" fill="#fff3cd" stroke="#f0ad4e"/>
            <text x="610" y="45" class="facility-text">ENTRANCE</text>

            <rect x="1140" y="780" width="120" height="60" fill="#ffebee" stroke="#c62828" rx="6"/>
            <text x="1155" y="815" class="facility-text">EMERGENCY EXIT</text>

            <!-- STALL GROUPS -->
            <g id="wetStalls"></g>
            <g id="dryStalls"></g>
          </g>
        </svg>
      </div>

      <div class="info-panel" id="info">
        Click a stall to view vendor info.
      </div>

     <div class="legend">
          <span><div class="legend-box fish"></div> Fish</span>
          <span><div class="legend-box meat"></div> Meat</span>
          <span><div class="legend-box grocery"></div> Grocery</span>
          <span><div class="legend-box drygoods"></div> Dry Goods</span>
          <span><div class="legend-box textile"></div> Textile</span>
          <span><div class="legend-box carinderia"></div> Carinderia</span>
          <span><div class="legend-box" style="border:2px solid #0a53c1;"></div> Occupied</span>
          <span><div class="legend-box" style="opacity:.6;"></div> Vacant</span>
          <span><div class="legend-box" style="background:red;color:white;"></div> Violation</span>
          <span><div class="legend-box" style="background:yellow;color:#111;"></div> Reserved</span>
        </div>
      </div>
  </section>
</div>

<script>
const vendors = {
  2:{name:"Pedro Fish Vendor",status:"occupied"},
  10:{name:"Maria Meat Shop",status:"occupied"},
  20:{name:"Juan Cold Storage",status:"violation"},
  105:{name:"Elena Boutique",status:"reserved"},
};

const STALL_SIZE = 40;
const GAP = 8;

function drawBlock(start, x, y, rows, cols, section){
  const g = document.getElementById(section === "wet" ? "wetStalls" : "dryStalls");
  let num = start;

  for(let r=0; r<rows; r++){
    for(let c=0; c<cols; c++){
      let sx = x + c * (STALL_SIZE + GAP);
      let sy = y + r * (STALL_SIZE + GAP);

      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", sx);
      rect.setAttribute("y", sy);
      rect.setAttribute("width", STALL_SIZE);
      rect.setAttribute("height", STALL_SIZE);
      rect.setAttribute("rx", "4");
      rect.classList.add("stall");

      let status = vendors[num] ? vendors[num].status : "vacant";
      rect.classList.add(status);
      rect.dataset.no = num;

      rect.onclick = (e) => {
        e.stopPropagation();
        const v = vendors[num];
        document.getElementById("info").innerHTML = v ?
          `<b>Stall ${num}</b> | Vendor: ${v.name} | Status: <b>${v.status.toUpperCase()}</b>` :
          `<b>Stall ${num}</b> | Status: <b>VACANT</b>`;
      };

      g.appendChild(rect);

      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
      text.setAttribute("x", sx + 8);
      text.setAttribute("y", sy + 25);
      text.setAttribute("font-size", "11");
      text.setAttribute("font-weight", "bold");
      text.textContent = num;
      text.style.pointerEvents = "none";
      g.appendChild(text);

      num++;
    }
  }
}

// NON-OVERLAPPING STALL ZONES
drawBlock(1,   250, 90,  3, 6, "wet");
drawBlock(20,  250, 330, 4, 6, "wet");
drawBlock(45,  250, 630, 4, 6, "wet");

drawBlock(100, 720, 90,  3, 8, "dry");
drawBlock(130, 720, 330, 4, 8, "dry");
drawBlock(170, 720, 630, 4, 8, "dry");

// ===== SMOOTH PAN & ZOOM (FIXED) =====
const wrapper = document.getElementById("wrapper");
const mapGroup = document.getElementById("map-group");

let scale = 1;
let panX = 0;
let panY = 0;
let isPanning = false;
let startX, startY;

function updateTransform() {
  mapGroup.setAttribute("transform", `translate(${panX}, ${panY}) scale(${scale})`);
}

wrapper.addEventListener("wheel", (e) => {
  e.preventDefault();

  const zoomFactor = 0.1;
  const direction = e.deltaY > 0 ? -1 : 1;
  const newScale = Math.min(Math.max(0.4, scale + direction * zoomFactor), 2.5);

  const rect = wrapper.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  const dx = (mouseX - panX) / scale;
  const dy = (mouseY - panY) / scale;

  panX = mouseX - dx * newScale;
  panY = mouseY - dy * newScale;

  scale = newScale;
  updateTransform();
}, { passive: false });

wrapper.addEventListener("mousedown", (e) => {
  if (e.target.classList.contains("stall")) return;
  isPanning = true;
  startX = e.clientX - panX;
  startY = e.clientY - panY;
  wrapper.style.cursor = "grabbing";
});

window.addEventListener("mouseup", () => {
  isPanning = false;
  wrapper.style.cursor = "default";
});

window.addEventListener("mousemove", (e) => {
  if (!isPanning) return;
  panX = e.clientX - startX;
  panY = e.clientY - startY;
  updateTransform();
});

// Initial position
panX = 20;
panY = 20;
updateTransform();
</script>
</body>
</html>

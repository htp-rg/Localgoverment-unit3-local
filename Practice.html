<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barangay Market Map - LGU Admin</title>

<style>
:root {
  --text:#111;
  --blue:#4e73df;
  --border:#e6e8eb;
  --shadow:0 6px 24px rgba(0,0,0,.06);
}

*{box-sizing:border-box;}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f4f6f9;
  overflow:hidden;
}

.app{
  display:grid;
  grid-template-columns:240px 1fr;
  height:100vh;
}

/* SIDEBAR */
.sidebar{
  background:var(--blue);
  color:#fff;
}
.brand{
  font-weight:bold;
  padding:1rem;
  border-bottom:1px solid rgba(255,255,255,.2);
}
nav{padding:1rem;}
.nav-item{
  display:block;
  padding:.6rem;
  border-radius:8px;
  text-decoration:none;
  color:#fff;
  margin-bottom:6px;
}
.nav-item:hover{background:rgba(255,255,255,.15);}

/* MAIN */
.main{
  display:grid;
  grid-template-rows:60px 1fr;
  background:#eaecf4;
}
.topbar{
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 1rem;
  border-bottom:1px solid var(--border);
}
.content{
  padding:1rem;
  display:flex;
  flex-direction:column;
}

/* MAP */
.map-wrapper{
  border:1px solid #ccc;
  background:#f8f9fc;
  width:100%;
  height:70vh;
  border-radius:12px;
  overflow:hidden;
  position: relative;
}
#map{transform-origin:0 0; cursor:grab; transition: transform 0.1s ease-out;}

/* STALL */
.stall{stroke:#444;stroke-width:.5;cursor:pointer;}
.stall:hover{stroke-width:2;stroke:#000;}
.occupied{fill:#9ec5ff;}
.vacant{fill:#fff;}
.violation{fill:#ff4d4d;}
.reserved{fill:#ffd700;}
.walkway{fill:#d1d3e2; opacity:.6;}
.label{font-size:18px; font-weight:bold; fill:var(--blue); text-transform: uppercase;}
.facility-text{font-size:11px; font-weight:bold; fill:#333; pointer-events: none;}

/* INFO */
.info-panel{
  margin-top:10px;
  background:#fff;
  padding:15px;
  border-radius:8px;
  border-left:5px solid var(--blue);
  box-shadow:var(--shadow);
  font-size:14px;
}
.legend{
  display:flex;
  gap:15px;
  margin-top:8px;
  font-size:12px;
}
.box{width:12px;height:12px;border:1px solid #333;}
.legend-item{display:flex;align-items:center;gap:5px;}
</style>
</head>
<div class="app">
  <aside class="sidebar">
    <div class="brand">LGU 3 ADMIN SYSTEM</div>
    <nav>
      <a href="admindashboard.html" class="nav-item active">Dashboard</a>
      <a href="adminvendor.html" class="nav-item">Vendor Management</a>
      <a href="admincommodity.html" class="nav-item">Commodity and Price Monitoring</a>
      <a href="admininspection.html" class="nav-item">Inspection and Compliance</a>
      <a href="adminsettings.html" class="nav-item">Settings</a>
      <a href="main.html" class="nav-item" style="margin-top:2rem;font-weight:bold;">Logout</a>
    </nav>
  </aside>

  <section class="main">
    <header class="topbar">
      <button class="btn" id="backBtn">‚Üê Back</button>
      <button class="btn">Export</button>
    </header>>

    <div class="content">
      <div class="map-wrapper" id="wrapper">
        <svg id="map" width="1300" height="900" viewBox="0 0 1300 900">
          
          <rect x="20" y="20" width="1260" height="860" fill="none" stroke="#b7b9cc" stroke-width="2" rx="10"/>

          <rect x="580" y="20" width="100" height="860" class="walkway"/>
          
          <rect x="20" y="250" width="560" height="60" class="walkway"/> <rect x="680" y="250" width="600" height="60" class="walkway"/> <rect x="20" y="550" width="560" height="60" class="walkway"/> <rect x="680" y="550" width="600" height="60" class="walkway"/> <text x="250" y="60" class="label">WET SECTION</text>
          <text x="880" y="60" class="label">DRY SECTION</text>

          <rect x="40" y="80" width="120" height="60" fill="#e3f2fd" stroke="#4e73df" rx="5"/>
          <text x="55" y="115" class="facility-text">ADMIN OFFICE</text>

          <rect x="40" y="780" width="90" height="60" fill="#e8f5e9" stroke="#2e7d32" rx="5"/>
          <text x="55" y="815" class="facility-text">CR MALE</text>
          
          <rect x="140" y="780" width="90" height="60" fill="#fce4ec" stroke="#c2185b" rx="5"/>
          <text x="150" y="815" class="facility-text">CR FEMALE</text>

          <rect x="580" y="20" width="100" height="40" fill="#fff3cd" stroke="#f0ad4e"/>
          <text x="595" y="45" class="facility-text" style="font-size:10px">MAIN ENTRANCE</text>

          <rect x="1160" y="780" width="100" height="60" fill="#ffebee" stroke="#c62828" rx="5"/>
          <text x="1175" y="815" class="facility-text">EMERGENCY</text>

          <g id="wetStalls"></g>
          <g id="dryStalls"></g>
        </svg>
      </div>

      <div class="info-panel" id="info">
        Click a stall to view vendor info.
      </div>

      <div class="legend">
        <div class="legend-item"><div class="box vacant"></div>Vacant</div>
        <div class="legend-item"><div class="box occupied"></div>Occupied</div>
        <div class="legend-item"><div class="box reserved"></div>Reserved</div>
        <div class="legend-item"><div class="box violation"></div>Violation</div>
      </div>
    </div>
  </section>
</div>

<script>
const vendors = {
  2:{name:"Pedro Fish Vendor",status:"occupied"},
  10:{name:"Maria Meat Shop",status:"occupied"},
  20:{name:"Juan Cold Storage",status:"violation"},
  105:{name:"Elena Boutique",status:"reserved"},
};

const STALL_SIZE = 40;
const GAP = 8;

function drawBlock(start, x, y, rows, cols, section){
  const g = document.getElementById(section === "wet" ? "wetStalls" : "dryStalls");
  let num = start;

  for(let r=0; r<rows; r++){
    for(let c=0; c<cols; c++){
      let sx = x + c * (STALL_SIZE + GAP);
      let sy = y + r * (STALL_SIZE + GAP);

      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", sx);
      rect.setAttribute("y", sy);
      rect.setAttribute("width", STALL_SIZE);
      rect.setAttribute("height", STALL_SIZE);
      rect.setAttribute("rx", "4");
      rect.classList.add("stall");

      let status = vendors[num] ? vendors[num].status : "vacant";
      rect.classList.add(status);
      rect.dataset.no = num;

      rect.onclick = (e) => {
        e.stopPropagation();
        const v = vendors[num];
        document.getElementById("info").innerHTML = v ?
          `<b>Stall ${num}</b> | Vendor: ${v.name} | Status: <span style="color:red">${v.status.toUpperCase()}</span>` :
          `<b>Stall ${num}</b> | Status: <span style="color:green">VACANT</span>`;
      };

      g.appendChild(rect);

      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
      text.setAttribute("x", sx + 8);
      text.setAttribute("y", sy + 25);
      text.setAttribute("font-size", "11");
      text.setAttribute("font-weight", "bold");
      text.textContent = num;
      text.style.pointerEvents = "none";
      g.appendChild(text);

      num++;
    }
  }
}

// DRAWING STALLS IN NON-OVERLAPPING ZONES
// Wet Section (Left of center aisle)
drawBlock(1, 250, 80, 3, 6, "wet");      // Top block
drawBlock(20, 250, 330, 4, 6, "wet");    // Middle block
drawBlock(45, 250, 630, 4, 6, "wet");    // Bottom block

// Dry Section (Right of center aisle)
drawBlock(100, 710, 80, 3, 8, "dry");    // Top block
drawBlock(130, 710, 330, 4, 8, "dry");   // Middle block
drawBlock(170, 710, 630, 4, 8, "dry");   // Bottom block

/* SEARCH LOGIC */
document.getElementById("search").oninput = function(){
  const val = this.value;
  document.querySelectorAll(".stall").forEach(s => {
    if(s.dataset.no === val && val !== ""){
      s.style.stroke = "#ff0000";
      s.style.strokeWidth = "4";
    } else {
      s.style.stroke = "";
      s.style.strokeWidth = "";
    }
  });
};

/* PAN & ZOOM */
let scale = 0.8, drag = false, startX, startY, offsetX = 50, offsetY = 20;
const map = document.getElementById("map");
const wrapper = document.getElementById("wrapper");

// Set initial view
map.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;

wrapper.addEventListener("wheel", e => {
  e.preventDefault();
  const delta = e.deltaY > 0 ? -0.1 : 0.1;
  scale = Math.min(Math.max(0.3, scale + delta), 2);
  map.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
}, {passive: false});

wrapper.addEventListener("mousedown", e => {
  if(e.target.classList.contains("stall")) return;
  drag = true;
  startX = e.clientX - offsetX;
  startY = e.clientY - offsetY;
  map.style.cursor = "grabbing";
});

window.addEventListener("mouseup", () => { drag = false; map.style.cursor = "grab"; });
window.addEventListener("mousemove", e => {
  if (!drag) return;
  offsetX = e.clientX - startX;
  offsetY = e.clientY - startY;
  map.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
});
</script>

</body>
</html>

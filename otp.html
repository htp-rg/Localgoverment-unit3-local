<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LGU 3 | OTP Verification</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body{
  margin:0;
  font-family:Inter,system-ui;
  background:linear-gradient(135deg,#0b2c6f,#1e4fd8);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  background:#fff;
  padding:2rem;
  border-radius:14px;
  width:360px;
}
input,button{
  width:100%;
  padding:.7rem;
  margin:.5rem 0;
  border-radius:10px;
}
button{background:#1e4fd8;color:#fff;border:none;font-weight:600}
#msg{text-align:center;font-weight:600}
</style>
</head>

<body>
<div class="card">
  <h2>OTP Verification</h2>

  <input type="text" id="otpInput" placeholder="Enter OTP">
  <button onclick="sendOTP()">Send OTP</button>
  <button onclick="verify()">Verify</button>

  <div id="msg"></div>
</div>

<script>
let otp=null;

const role=localStorage.getItem("role");
const email=localStorage.getItem("email");

const roles={
  staff:{key:"woZPn1QHpjKc4M8Qo",service:"service_dvrf2ar",template:"template_tseir4g",redirect:"barangayinspection.html"},
  market:{key:"Q3BrdJupCkfLyAxc9",service:"service_twsjr4p",template:"template_864di8m",redirect:"Marketmap.html"},
  admin:{key:"ITbHFP1WBTFPISemM",service:"service_qvm338i",template:"template_koj1ggb",redirect:"admindashboard.html"},
  user:{key:"rmTZmSimwN_68ZgFp",service:"service_da66ha6",template:"template_0mebf9d",redirect:"userdashboard.html"}
};

function sendOTP(){
  emailjs.init(roles[role].key);
  otp=Math.floor(100000+Math.random()*900000);

  emailjs.send(roles[role].service,roles[role].template,{
    to_email:email,
    passcode:otp
  });

  msg.textContent="OTP sent to email";
}

function verify(){
  if(otpInput.value==otp){
    msg.style.color="green";
    msg.textContent="Login successful";
    setTimeout(()=>window.location.href=roles[role].redirect,1000);
  }else{
    msg.style.color="red";
    msg.textContent="Invalid OTP";
  }
}
</script>
</body>
</html>

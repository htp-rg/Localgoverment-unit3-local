<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reports & Analytics</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --text: #111111;
  --blue: #0a53c1;
  --ink-20: #f4f6f8;
  --white: #ffffff;
  --border: #e6e8eb;
  --shadow: 0 6px 24px rgba(0, 0, 0, .06);
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: var(--white);
  color: var(--text);
}
.app { display: grid; grid-template-columns: 240px 1fr; min-height: 100vh; }

.sidebar {
  border-right: 1px solid var(--border);
  background: var(--white);
}
.brand {
  font-weight: 800;
  text-transform: uppercase;
  padding: 1rem;
  border-bottom: 1px solid var(--border);
}
nav { padding: 1rem; }
.nav-item {
  display: block; padding: .6rem;
  border-radius: 8px; text-decoration: none; color: var(--text);
}
.nav-item:hover, .nav-item.active { background: var(--ink-20); }

.main { display: grid; grid-template-rows: 64px 1fr; min-width: 0; }
.topbar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 1rem; border-bottom: 1px solid var(--border);
}
.btn {
  border: 1px solid var(--text);
  background: transparent; padding: .4rem .8rem;
  border-radius: 8px; cursor: pointer;
}
.content { padding: 1rem; overflow: auto; }
.card {
  border: 1px solid var(--border);
  border-radius: 12px; padding: 1rem;
  box-shadow: var(--shadow);
}
.menu-container {
  position: relative;
  display: inline-block;
}
.dropdown {
  display: none;
  position: absolute;
  top: 110%;
  right: 0;
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: var(--shadow);
  min-width: 220px;
  z-index: 1000;
}
.dropdown p {
  margin: 0;
  padding: 0.8rem;
  font-weight: bold;
  border-bottom: 1px solid var(--border);
}
.dropdown a {
  display: block;
  padding: 0.8rem;
  text-decoration: none;
  color: var(--text);
  border-bottom: 1px solid var(--border);
}
.dropdown a:hover { background: var(--ink-20); }
.dropdown a:last-child { border-bottom: none; }
.dropdown.show { display: block; }

.chat-message {
  max-width: 70%;
  padding: .5rem .8rem;
  border-radius: 12px;
  word-wrap: break-word;
  font-size: 0.9rem;
  position: relative;
}
.chat-user {
  align-self: flex-end;
  background: #0a53c1;
  color: white;
  border-bottom-right-radius: 0;
}
.chat-bot {
  align-self: flex-start;
  background: #e6e6e6;
  color: #111;
  border-bottom-left-radius: 0;
}
.chat-timestamp {
  font-size: 0.7rem;
  opacity: 0.6;
  margin-top: 2px;
  text-align: right;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
}
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand">LGU 3 ADMIN SYSTEM</div>
    <nav>
      <a href="admindashboard.html" class="nav-item">Dashboard</a>
      <a href="adminvendor.html" class="nav-item ">Vendor Management</a>
      <a href="admincommodity.html" class="nav-item">Commodity & Price Monitoring</a>
      <a href="adminsupply.html" class="nav-item">Supply Monitoring</a>
      <a href="admininspection.html" class="nav-item">Inspection & Compliance</a>
      <a href="reports.html" class="nav-item active">Reports & Analytics</a>
      <a href="adminsettings.html" class="nav-item">Settings</a>
      <a href="loginadmin.html" class="nav-item" style="margin-top:2rem; font-weight:bold;">Logout</a>
    </nav>
  </aside>

  <section class="main">
    <header class="topbar">
      <div style="display:flex; align-items:center; gap:.5rem;">
        <button class="btn" id="backBtn">‚Üê Back</button>
        <div class="menu-container">
          <button class="btn" id="menuBtn">‚ò∞</button>
          <div class="dropdown" id="menuDropdown">
            <p id="adminName">Admin</p>
            <a href="upgrade.html">Upgrade Personal Details</a>
            <a href="adminpassword.html">Password and Security</a>
            <a href="#" id="deleteAccount">Delete Account</a>
            <a href="terms.html">Terms of Service</a>
            <a href="adminreport.html">Report a Problem</a>
            <a href="main.html" id="signOut">Sign Out</a>
          </div>
        </div>
      </div>
      <div>
        <button class="btn" id="exportBtn">Export</button>
      </div>
    </header>

    <div class="content">
      <h1>Reports and Dashboard with AI Analytic</h1>
      <div class="grid">
        <div class="card">
          <h3>Vendor Performance Dashboard</h3>
          <canvas id="vendorChart" height="120"></canvas>
        </div>
        <div class="card">
          <h3>Recent Complaints</h3>
          <div id="complaintsContainer" style="display:none;">
            <p id="complaintMessage" style="background:#fce8b2;padding:.5rem;border-radius:6px;"></p>
          </div>
          <select id="complaintSelect" style="margin-top:.5rem;width:100%;padding:.4rem;"></select>
          <button id="viewComplaintBtn" class="btn" style="margin-top:.5rem;">View Complaint</button>
        </div>
        <div class="card">
          <h3>AI Chat Support</h3>
          <div id="chatboxContainer" style="
               border:1px solid #ccc;
               padding:10px;
               border-radius:8px;
               height:300px;
               overflow-y:auto;
               display:flex;
               flex-direction:column;
               gap:.5rem;
               background:#f9f9f9;"></div>
          <div style="margin-top:.5rem;display:flex;gap:.5rem;">
            <input id="chatInput" type="text" placeholder="Type your question..." style="flex:1;padding:.5rem;border:1px solid #ccc;border-radius:6px;">
            <button id="chatSendBtn" class="btn">Send</button>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
function initComplaints() {
  const container = document.getElementById("complaintsContainer");
  const message = document.getElementById("complaintMessage");
  const select = document.getElementById("complaintSelect");
  const viewBtn = document.getElementById("viewComplaintBtn");

  let defaultComplaints = {
    "RPT-001": "Vendor delayed chicken delivery",
    "RPT-002": "Incomplete Takoyaki supplies",
    "RPT-003": "Catering delivery arrived late",
    "RPT-004": "Rental items missing on arrival"
  };

  let complaints = JSON.parse(localStorage.getItem("complaints"));
  if (!complaints) {
    complaints = defaultComplaints;
    localStorage.setItem("complaints", JSON.stringify(complaints));
  }


  select.innerHTML = `<option value="">-- Select Complaint Ref No. --</option>`;
  Object.keys(complaints).forEach(ref => {
    const opt = document.createElement("option");
    opt.value = ref;
    opt.textContent = ref;
    select.appendChild(opt);
  });

  viewBtn.onclick = () => {
    const ref = select.value;
    if (ref && complaints[ref]) {
      container.style.display = "block";
      message.textContent = `(${ref}) ${complaints[ref]}`;
    } else {
      alert("Please select a complaint Ref No. first.");
    }
  };
}

function initReports() {

  const ctx = document.getElementById("vendorChart");
  if (ctx) {
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Takoyaki", "Meat Shop", "Catering", "Rental"],
        datasets: [{
          label: "Performance",
          data: [87, 65, 72, 90],
          backgroundColor: "#0a53c1"
        }]
      },
      options: { responsive: true, scales: { y: { beginAtZero:true, max:100 } } }
    });
  }


  const chatBox = document.getElementById("chatboxContainer");
  const chatInput = document.getElementById("chatInput");
  const chatSendBtn = document.getElementById("chatSendBtn");

  function addMessage(sender, text) {
    const div = document.createElement("div");
    const time = new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    div.className = `chat-message ${sender==="You"?"chat-user":"chat-bot"}`;
    div.innerHTML = `${text}<div class="chat-timestamp">${time}</div>`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function botReply(msg) {
    msg = msg.toLowerCase();
    if(msg.includes("status")) return "üìä Current reports show most vendors are on track, with 2 pending complaints.";
    if(msg.includes("performance")) return "‚úÖ Vendor performance is averaging 85%, with rentals leading at 90%.";
    if(msg.includes("complaint")) return "‚ö†Ô∏è There are 4 active complaints. Select a Ref No. to view details.";
    if(msg.includes("hello")||msg.includes("hi")) return "üëã Hello! How can I assist you today?";
    return "ü§ñ Sorry, I don‚Äôt have an answer for that. Try asking about 'status', 'performance', or 'complaints'.";
  }

  chatSendBtn.onclick = () => {
    const text = chatInput.value.trim();
    if(text){
      addMessage("You", text);
      setTimeout(()=>addMessage("Bot", botReply(text)),500);
      chatInput.value="";
    }
  };

  chatInput.addEventListener("keypress", e=>{
    if(e.key==="Enter") chatSendBtn.click();
  });
}

window.onload = () => {
  document.getElementById("adminName").textContent = localStorage.getItem("adminName") || "Admin";
  initReports();
  initComplaints();
};
</script>
</body>
</html>
